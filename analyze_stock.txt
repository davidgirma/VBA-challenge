Sub analyze_stock()        ' Asking which quarter does the end user wants to analyze    quarter = InputBox("Please enter the quarter you want to analyze: [Q1, Q2, Q3 or Q4],")    Dim Selected_Quarter As Integer    Selected_Quarter = CInt(Right(quarter, 1))    MsgBox ("Selected quarter: " & Selected_Quarter)        ' Set an initial variable for holding the stock name (ticker)    Dim Stock_Name As String        ' Set an initial variable for holding the total of each stock    Dim Stock_Total As LongLong        ' Keep track of the location for each stock in the summary table    Dim Summary_Table_Row As Long    Summary_Table_Row = 2        ' Opening and closing prices of a stock of a given quarter    ' Stock counter used to determine the opening price    Dim Opening_Price As Single    Dim Closing_Price As Single    Dim Stock_Counter As Long        ' Loop through all sheets    For Each ws In Worksheets        'Get the last row for each worksheet        LastRow = ws.Cells(Rows.Count, 1).End(xlUp).Row                ' Transform column B to date format (only applies if the dates        ' are shown in the aaaammdd format        If IsDate(ws.Cells(2, 2).Value) Then                Else            For i = 2 To LastRow                ws.Cells(i, 2).Value = DateSerial(Left(ws.Cells(i, 2).Value, 4), _                Mid(ws.Cells(i, 2).Value, 5, 2), _                Right(ws.Cells(i, 2).Value, 2))            Next i        End If                ' Loop through all rows of active sheet        For i = 2 To LastRow                        ' Check for data in the selected quarter            If Selected_Quarter = 1 Then                                  ' Validate if there will be a change of stock name                 If ws.Cells(i + 1, 1).Value <> ws.Cells(i, 1).Value Then                                            ' Set the stock name                    Stock_Name = ws.Cells(i, 1).Value                                        ' Add to the stock total                    Stock_Total = Stock_Total + ws.Cells(i, 7).Value                                        ' Print the stock name in the summary table                    Worksheets(1).Cells(Summary_Table_Row, 9).Value = Stock_Name                        ' Print the stock total to the summary table                    Worksheets(1).Cells(Summary_Table_Row, 12).Value = Stock_Total                                        'Reset the stock total                    Stock_Total = 0                                        'Closing price is determined                    Closing_Price = ws.Cells(i, 6).Value                                        'Calculate the quarterly change                    Worksheets(1).Cells(Summary_Table_Row, 10).Value = _                    Format(Closing_Price - Opening_Price, ".00")                                        ' Highlighting positive/negative changes colorwise                    If Worksheets(1).Cells(Summary_Table_Row, 10).Value > 0 Then                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 4                    ElseIf Worksheets(1).Cells(Summary_Table_Row, 10).Value < 0 Then                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 3                    Else                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 2                    End If                        'Calculate the percent change                    Worksheets(1).Cells(Summary_Table_Row, 11).Value = _                    Format((Closing_Price - Opening_Price) / Opening_Price, ".00%")                                                        ' Add one to the summary table row                    Summary_Table_Row = Summary_Table_Row + 1                                        'Reset the stock counter                    Stock_Counter = 0                                    ElseIf Month(ws.Cells(i, 2)) <= 3 Then                                            'Opening price is determined using the stock counter                    If Stock_Counter = 0 Then                        Opening_Price = ws.Cells(i, 3).Value                    End If                    Stock_Counter = Stock_Counter + 1                                        'Closing price is determined                    Closing_Price = ws.Cells(i, 6).Value                                        'Add to the stock total                    Stock_Total = Stock_Total + ws.Cells(i, 7).Value                End If                            ElseIf Selected_Quarter = 2 Then                            If ws.Cells(i + 1, 1).Value <> ws.Cells(i, 1).Value Then                    Stock_Name = ws.Cells(i, 1).Value                    Stock_Total = Stock_Total + ws.Cells(i, 7).Value                    Worksheets(1).Cells(Summary_Table_Row, 9).Value = Stock_Name                    Worksheets(1).Cells(Summary_Table_Row, 12).Value = Stock_Total                    Stock_Total = 0                    Closing_Price = ws.Cells(i, 6).Value                    Worksheets(1).Cells(Summary_Table_Row, 10).Value = _                    Format(Closing_Price - Opening_Price, ".00")                    If Worksheets(1).Cells(Summary_Table_Row, 10).Value > 0 Then                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 4                    ElseIf Worksheets(1).Cells(Summary_Table_Row, 10).Value < 0 Then                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 3                    Else                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 2                    End If                    Worksheets(1).Cells(Summary_Table_Row, 11).Value = _                    Format((Closing_Price - Opening_Price) / Opening_Price, ".00%")                    Summary_Table_Row = Summary_Table_Row + 1                    Stock_Counter = 0                ElseIf Month(ws.Cells(i, 2)) > 3 And Month(ws.Cells(i, 2)) <= 6 Then                    If Stock_Counter = 0 Then                        Opening_Price = ws.Cells(i, 3).Value                    End If                    Stock_Counter = Stock_Counter + 1                    Closing_Price = ws.Cells(i, 6).Value                    Stock_Total = Stock_Total + ws.Cells(i, 7).Value                End If                            ElseIf Selected_Quarter = 3 Then                            If ws.Cells(i + 1, 1).Value <> ws.Cells(i, 1).Value Then                    Stock_Name = ws.Cells(i, 1).Value                    Stock_Total = Stock_Total + ws.Cells(i, 7).Value                    Worksheets(1).Cells(Summary_Table_Row, 9).Value = Stock_Name                    Worksheets(1).Cells(Summary_Table_Row, 12).Value = Stock_Total                    Stock_Total = 0                    Closing_Price = ws.Cells(i, 6).Value                    Worksheets(1).Cells(Summary_Table_Row, 10).Value = _                    Format(Closing_Price - Opening_Price, ".00")                    If Worksheets(1).Cells(Summary_Table_Row, 10).Value > 0 Then                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 4                    ElseIf Worksheets(1).Cells(Summary_Table_Row, 10).Value < 0 Then                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 3                    Else                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 2                    End If                    Worksheets(1).Cells(Summary_Table_Row, 11).Value = _                    Format((Closing_Price - Opening_Price) / Opening_Price, ".00%")                    Summary_Table_Row = Summary_Table_Row + 1                    Stock_Counter = 0                ElseIf Month(ws.Cells(i, 2)) > 6 And Month(ws.Cells(i, 2)) <= 9 Then                    If Stock_Counter = 0 Then                        Opening_Price = ws.Cells(i, 3).Value                    End If                    Stock_Counter = Stock_Counter + 1                    Closing_Price = ws.Cells(i, 6).Value                    Stock_Total = Stock_Total + ws.Cells(i, 7).Value                End If                            ElseIf Selected_Quarter = 4 Then                If ws.Cells(i + 1, 1).Value <> ws.Cells(i, 1).Value Then                    Stock_Name = ws.Cells(i, 1).Value                    Stock_Total = Stock_Total + ws.Cells(i, 7).Value                    Worksheets(1).Cells(Summary_Table_Row, 9).Value = Stock_Name                    Worksheets(1).Cells(Summary_Table_Row, 12).Value = Stock_Total                    Stock_Total = 0                    Closing_Price = ws.Cells(i, 6).Value                    Worksheets(1).Cells(Summary_Table_Row, 10).Value = _                    Format(Closing_Price - Opening_Price, ".00")                    If Worksheets(1).Cells(Summary_Table_Row, 10).Value > 0 Then                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 4                    ElseIf Worksheets(1).Cells(Summary_Table_Row, 10).Value < 0 Then                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 3                    Else                        Worksheets(1).Cells(Summary_Table_Row, 10).Interior.ColorIndex = 2                    End If                    Worksheets(1).Cells(Summary_Table_Row, 11).Value = _                    Format((Closing_Price - Opening_Price) / Opening_Price, ".00%")                    Summary_Table_Row = Summary_Table_Row + 1                    Stock_Counter = 0                ElseIf Month(ws.Cells(i, 2)) >= 9 Then                    If Stock_Counter = 0 Then                        Opening_Price = ws.Cells(i, 3).Value                    End If                    Stock_Counter = Stock_Counter + 1                    Closing_Price = ws.Cells(i, 6).Value                    Stock_Total = Stock_Total + ws.Cells(i, 7).Value                End If            End If                    Next i            Next ws        ' Adding the headers/titles for columns I-L    Worksheets(1).Cells(1, 9).Value = "Ticker"    Worksheets(1).Cells(1, 10).Value = "Quarterly Change"    Worksheets(1).Cells(1, 11).Value = "Percent Change"    Worksheets(1).Cells(1, 12).Value = "Total Stock Volume"        ' Adding the headers/titles for columns O-Q    Worksheets(1).Cells(1, 16).Value = "Ticker"    Worksheets(1).Cells(1, 17).Value = "Value"    Worksheets(1).Cells(2, 15).Value = "Greatest % Increase"    Worksheets(1).Cells(3, 15).Value = "Greatest % Decrease"    Worksheets(1).Cells(4, 15).Value = "Greatest Total Volume"        ' Calculating greatest increases and decreases (%), and max volume    ' =INDEX(I:I,MATCH(MAX(K:K),K:K,0))    ' =INDEX(I:I,MATCH(MIN(K:K),K:K,0))    ' =INDEX(I:I,MATCH(MAX(L:L),L:L,0))    Worksheets(1).Cells(2, 17).Value = WorksheetFunction.Max(Range("K:K"))    Worksheets(1).Cells(3, 17).Value = WorksheetFunction.Min(Range("K:K"))    Worksheets(1).Cells(4, 17).Value = WorksheetFunction.Max(Range("L:L"))        Worksheets(1).Cells(2, 16).Value = WorksheetFunction.Index(Range("I:I"), _    WorksheetFunction.Match(WorksheetFunction.Max(Range("K:K")), Range("K:K"), 0))    Worksheets(1).Cells(3, 16).Value = WorksheetFunction.Index(Range("I:I"), _    WorksheetFunction.Match(WorksheetFunction.Min(Range("K:K")), Range("K:K"), 0))    Worksheets(1).Cells(4, 16).Value = WorksheetFunction.Index(Range("I:I"), _    WorksheetFunction.Match(WorksheetFunction.Max(Range("L:L")), Range("L:L"), 0))        ' Percentage format    Worksheets(1).Cells(2, 17).NumberFormat = "0.00%"    Worksheets(1).Cells(3, 17).NumberFormat = "0.00%"        ' Adjust the width of the columns    Worksheets(1).Columns("A:Q").AutoFit    End Sub